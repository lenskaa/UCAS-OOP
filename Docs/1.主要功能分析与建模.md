# 主要功能分析与建模

本报告为 2021 年中国科学院大学王伟老师的面向对象程序设计课程的大作业。本节内容将涉及对软件功能的整体描述与具体分析，最后抽象出完成设计所需要的类。

## 1. 软件功能描述

本次大作业将设计实现一个 Uno 纸牌游戏，主要包含以下功能：

* 基础卡牌游戏：支持发牌，出牌，抽牌，判赢
* Uno 特殊卡牌：支持 Uno 中的特殊功能牌

***

## 2. 需求分析 

下面我们针对以上拟实现的每一个功能进行需求分析，从而从中抽象出类和对象：

### 1. 牌桌

游戏需要一个窗口作为牌桌，以便游戏进行。

```
【用例名称】
    牌桌
【场景】
    Who: 玩家，裁判；
    Where: 显示屏；
    When: 游戏全过程。
【用例描述】
    1. 游戏启动时，生成一张牌桌；
    2. 游戏开始后，在牌桌上放置卡牌，并在牌桌上进行游戏；
    3. 游戏结束后，关闭牌桌；
【用例价值】
    玩家在牌桌上进行游戏。
【约束和限制】
    1. 牌桌尺寸应当适应屏幕。
```

### 2. 游戏进行

维护游戏的正常进行，每个玩家在自己的回合出牌，有玩家出完牌后游戏结束。

```
【用例名称】
    游戏进行
【场景】
    Who: 玩家，裁判；
    Where: 牌桌；
    When: 游戏进行时。
【用例描述】
    1. 游戏开始后，向各玩家发牌，放到牌桌上；
    2. 发牌结束后，从牌堆中随机抽出一张数字牌作为起始牌；
    	2.1 抽出的牌不是数字牌，则放回牌堆重抽一张
    3. 每个玩家轮流出牌或抽牌；
    4. 循环第三步直到有玩家手牌出完，宣布胜利。
【用例价值】
    维持游戏的正常进行。
【约束和限制】
    1. 出牌和抽牌应该符合游戏规则。
    2. 出牌需要按照固定顺序。
```

### 3. 牌堆初始化

在游戏开始之前，需要按照 Uno 规则创建初始牌堆。

```
【用例名称】
    牌堆初始化
【场景】
    Who: 裁判；
    Where: 牌桌；
    When: 游戏开始前。
【用例描述】
    1. 玩家点击“新游戏”；
    2. 按照 Uno 规则生成一套卡牌；
    3. 将卡牌背面朝上放在牌桌上；
【用例价值】
    为一局游戏准备好卡牌。
【约束和限制】
    1. 卡牌数量、类型应该符合规则。
```

### 4. 出牌 

轮到一名玩家的回合时，玩家可以选择一张牌打出。

```
【用例名称】
    出牌
【场景】
    Who: 玩家，裁判；
    Where: 牌桌；
    When: 轮到一名玩家的回合时。
【用例描述】
    1. 玩家选择一张卡牌打出；
        1.1 玩家出的牌不符合出牌规则，则重新出牌；
        1.2 前一个玩家打出 Uno 功能牌，后一个玩家应按照特殊规则出牌
        1.3 玩家出的牌是 Uno 功能牌，应当在出牌同时选择特殊效果
    2. 将打出的卡牌摆放到牌桌弃牌区；
【用例价值】
    玩家可以打出一张牌。
【约束和限制】
    1. 出牌应当符合出牌规则。
    2. 玩家只能在自己的回合出牌
```

### 5. 出牌 

轮到一名玩家的回合时，玩家可以选择从牌堆抽牌。

```
【用例名称】
    出牌
【场景】
    Who: 玩家，裁判；
    Where: 牌桌；
    When: 轮到一名玩家的回合时。
【用例描述】
    1. 玩家从牌堆抽牌；
        1.2 前一个玩家打出 Uno 功能牌，后一个玩家应按照特殊规则抽牌
    2. 将抽到的卡牌摆放到玩家手牌区；
【用例价值】
    玩家可以抽牌。
【约束和限制】
    1. 抽牌数量应当符合抽牌规则。
    2. 玩家只能在自己的回合抽牌
```

***

## 3. 类的抽象

根据需求分析，我们抽象出需要的类及其属性与方法：

|    类    |                             属性                             |                 方法                 |
| :------: | :----------------------------------------------------------: | :----------------------------------: |
|   游戏   |                       窗口，玩家，裁判                       |         游戏控制，发牌，开局         |
|   窗口   |                  窗口尺寸，窗口名，窗口内容                  |          添加卡牌，移动卡牌          |
|   玩家   |                      玩家牌堆，玩家牌数                      |        出牌，翻面，初始化牌堆        |
|   卡牌   | 卡牌类型，卡牌颜色，卡牌功能，卡牌所有者，卡牌朝向，卡牌尺寸，卡牌位置 |                 翻面                 |
|   裁判   |          牌局信息，裁判牌堆，裁判牌数，特殊颜色牌堆          | 抽牌，初始化牌堆，出牌检查，判断胜负 |
| 牌局信息 |   玩家号，卡牌颜色，卡牌数字，抽卡数量，行动顺序，能否出牌   |               切换玩家               |

其中，卡牌可以分类为数字牌，彩色功能牌，黑色功能牌和特殊颜色牌，考虑抽象为一个卡牌抽象类和四个子类：

|     类     |                        属性                        |
| :--------: | :------------------------------------------------: |
|  抽象卡牌  | 卡牌类型，卡牌所有者，卡牌朝向，卡牌尺寸，卡牌位置 |
|   数字牌   |                 卡牌颜色，卡牌数字                 |
| 彩色功能牌 |                 卡牌颜色，卡牌功能                 |
| 黑色功能牌 |                      卡牌功能                      |
| 特殊颜色牌 |                      卡牌颜色                      |

考虑到卡牌的类别较多，实例化参数也较多，因此可以使用卡牌工厂创建卡牌。

在本次大作业中，动画部分使用了 Java Swing 实现，表格中仅列举了和 Uno 游戏相关的主要属性和方法，和动画相关的属性和方法没有列出。以上类的具体实现可参考代码，此处不占用过多篇幅。